# YunTuKu
这是一个基于springboot+vue+COS的云图库系统。它通过cos存储对象实现本地数据库的低负载，再利用多级缓存来提升系统响应速度，是一个较为完整且成本极低的项目。在完成该项目时，我们使用了大量的java技术。

  后端
  
1.基于自研的 Spring Boot 项目模板 + MyBatis Plus + MyBatis X 插件构建核心业务，实现用户、图片、空间等实体表的 CRUD 操作。

2.使用 Spring Initializr 初始化项目，实现 MyBatis Plus、Hutool、Knife4j 接口文档、Lombok 等主流依赖整合。

3.引入 MyBatis Plus 实现 Mapper 自动扫描，并基于其 BaseMapper + 自定义分页拦截器快速实现 CRUD 操作，减少了大量样板代码。

4.统一异常管理：封装了自定义异常类及统一错误码枚举类，并基于 @RestControllerAdvice 注解开发全局异常处理器，提升了系统的稳定性。

5.统一响应封装：自定义响应封装类和返回成功 / 失败响应的工具类，实现了标准化的接口响应数据格式，便于前后端交互。

6.全局跨域配置：基于 WebMvcConfigurer 实现了全局 CORS 配置类，配置可信源，解决了前后端跨域请求问题。

7.精度丢失解决：自定义 Jackson 配置类，通过 ObjectMapper 配置 Long 类型序列化为字符串，解决前端因 JS 精度限制导致的长整型数据精度丢失问题，确保前后端数据一致。

8.通过 MyBatis Plus 的 LambdaQueryWrapper 和 SqlRunner 构造动态 SQL 查询，简化了操作数据库的编码。

9.库表设计：根据业务设计用户、图片、空间、空间成员表，其中图片标签采用 JSON 数组存储，便于维护；并通过给空间成员关联表添加联合索引来提升检索性能。

10.使用 Knife4j 自动生成接口文档，并基于 ApiOperation 注解编写接口注释，减少了人工维护文档的工作量，提高了接口可读性。

11.用户注册：使用 MD5 + 盐值加密策略对用户密码进行加密存储，防止明文密码泄露风险。

12.用户登录：通过 Redis 整合 Spring Session 分布式保存用户登录态，实现了跨服务器的用户识别。

13.权限管理：基于自定义权限校验注解和 Spring AOP 环绕切面，实现了统一的权限校验，区分用户和管理员。

14.图片存管：基于 COS 对象存储 SDK 封装了通用文件上传下载服务，并基于数据万象服务自动解析图片信息（包括宽高、格式、大小等），便于检索。

15.图片审核：设计分级审核策略，管理员上传图片自动通过审核，并自动记录审核时间与审核人 id，确保可审计追溯。

16.URL 传图：使用 Hutool 请求 URL 来下载图片，并在下载前通过 Head 请求校验 URL，有效降低带宽消耗与数据异常风险。

17.运用 模板方法 设计模式统一封装本地图片和 URL 图片上传的流程，如校验、下载、上传和资源释放，复用代码并提高可维护性。

18.批量导图：利用 Jsoup 实现 Bing 网页图片抓取，并通过 CompletableFuture 实现批量上传和入库，性能提升 300%。

19.查询优化：为提高主页热门图片的查询性能，采用 Redis + Caffeine 构建 多级缓存，接口响应耗时降低 400%，并通过随机过期时间降低缓存雪崩风险。

20.加载优化：利用数据万象，在上传前对大文件进行 Webp 转码压缩和缩略图生成，再配合 CDN，大幅提高页面加载速度并节约成本。

21.存储优化：利用对象存储的数据沉降功能，对 30 天未访问图片自动 降频存储，并开发失效图片定时清理功能，大幅节约存储成本。

22.上传优化：为提高大文件上传效率，设计实现了基于 MD5 校验的 图片秒传 功能，并使用 COS SDK 实现大文件分片上传和断点续传。

23.空间创建：基于 分段锁 + TransactionTemplate 编程式事务实现了空间创建服务，限制每个用户最多创建一个私有空间。

24.空间额度：通过 TransactionTemplate 编程式事务，确保上传图片到空间时会增加存储额度的占用；并通过限流和预校验机制防止存储额度超限。

25.图片搜索：基于 MyBatis Plus 封装了将对象转换为 SQL 查询的通用方法，支持按关键词、标签、分类、时间范围等多维度组合搜索。

26.批量编辑：通过 Transactional 事务管理确保批量编辑图片的原子性；并利用 ThreadPoolExecutor + 数据库批处理进一步优化了批处理性能。

27.空间分析：运用 group by 实现数据的聚合统计，并通过 MyBatis Plus 的 selectObjs 方法按需选择字段，提高查询性能并节约内存占用。

28.成员管理：设计 space_user 关联表保存团队空间成员及角色信息，使用唯一联合索引防止成员重复加入，同时提升查询性能。

29.运用 @Lazy 注解，解决了空间服务和空间成员服务互相引用导致的循环依赖问题。

30.权限管理：基于 Sa-Token 的 Kit 模式实现了多账号体系的 RBAC 权限控制，通过从请求上下文中获取参数实现了统一的权限校验逻辑，并运用注解合并简化了鉴权注解的使用，轻松实现方法级别的权限校验。

31.协作编辑：基于 WebSocket + 事件驱动设计 实现多人协作编辑图片功能，自定义握手拦截器确保权限校验通过后才能连接，并通过 “编辑锁” 机制，避免编辑冲突。

32.部署上线：通过宝塔 Linux 的 Java 项目管理器部署 jar 包，并通过 Nginx 配置反向代理解决跨域问题。

  前端
  
1.基于 Vue3 + Ant Design Vue 组件库，开发公共图库、私有空间、团队管理、图库分析等 15 个页面，

2.使用 create-vue 脚手架 + Vite 初始化项目，自主开发了包含全局页面布局、导航菜单和通用组件的前端模板，便于后续复用。

3.采用 TypeScript + ESLint + Prettier 进行前端工程化管理，并自定义了 ESLint 规则，提高项目编码质量。

4.导航菜单生成：基于 Vue Router 的路由配置自动生成导航菜单，并通过给路由的 meta 属性增加 hideInMenu 字段实现集中控制页面的显隐。

5.全局权限管理：给 Vue Router 路由添加 meta.access 字段，通过 beforeEach 全局路由守卫集中校验用户有无页面权限，并进一步将权限管理相关代码封装为独立模块，简化使用。

6.全局状态管理：基于 Pinia 定义 UserStore 实现了对用户登录态的存储，并通过组合式 API（useStore）在各页面中访问用户信息。

7.全局请求：自定义 Axios 实例作为多环境通用的请求工具，并通过全局响应拦截器实现统一的请求错误消息提示。

8.前后端联调：使用 OpenAPI 工具根据 Swagger 接口文档生成 TS 模型和请求代码，减少手写接口的成本，大幅提高开发效率。

9.管理页面：基于 Ant Design 的 Table + Form 组件实现了各类管理界面，支持分页、筛选、排序、搜索，并利用插槽特性优化了表格列的展示效果。

10.图片上传：基于 Ant Design 的 Upload 组件封装了本地与 URL 两种上传组件，并支持图片大小、格式的前端校验。

11.图片详情：通过 Vue Router 动态路由，在页面中根据 url 获取到图片 id，并通过 watchEffect 监听 id 变化以触发图片查询请求。

12.图片下载：集成 file-saver 库，实现从对象存储的 URL 下载图片功能，用户可一键保存图片至本地。

13.图片展示：利用 Ant Design 的 List + Card 组件优化图片列表的响应式展示，结合 CSS 的 object-fit 属性确保图片比例一致。

14.图片搜索：支持关键词、标签分类、颜色搜索、以图搜图等多维度检索，基于 ref + watchEffect 自动监听搜索条件并发起查询请求。

15.图片优化：采用图片压缩、懒加载、缩略图、CDN 加速、浏览器缓存等措施，提升页面加载速度并节省流量。

16.图片分享：基于 Modal 组件实现分享弹窗组件，支持复制链接、扫码分享，并通过 defineExpose 暴露打开弹窗的方法，便于父组件使用。

17.图片编辑：基于 vue-cropper 组件封装了图片编辑组件，支持裁剪、旋转、缩放等功能，并通过 ref 获取裁剪后的 Blob 数据，实现编辑后自动上传。

18.空间分析：基于 ECharts 封装了多个分析图表组件（如分组条形图、词云图），并通过 computed 动态生成 ECharts 配置项，支持自动刷新数据。

19.实时协作：基于 WebSocket 事件驱动实现图片协同编辑，通过 “编辑锁” 与冲突检测机制防止编辑冲突，提升团队协作效率。

系统设计：


![E-R图](https://github.com/user-attachments/assets/db6ba750-2ba4-46ac-b91c-7a41b82a1461)
